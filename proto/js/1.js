(function(){var a={randFloat:function(h,g){return h+Math.random()*(g-h)},randInt:function(h,g){var j=g-h+1;var i=Math.floor(Math.random()*j);if(i===j){i-=1}return h+i}};window.utils=a;(function(){var i=1e-9;var g=function g(j,k){this.x=j||0;this.y=k||0};window.point=g;var h=function h(j,k){this.x=j||0;this.y=k||0};window.vector=h;h.prototype={abs:function(){var j=this.x,k=this.y;return Math.sqrt(j*j+k*k)},getUnitVector:function(){var j=this.abs();return new h(this.x/j,this.y/j)},rotate:function(k){if(!this.x&&!this.y){return this}var l=Math.abs(this.x)<i?this.y>0?Math.PI/2:-Math.PI/2:Math.atan(this.y/this.x);l+=this.y<0?Math.PI:0;l+=k;var j=this.abs();return new h(j*Math.cos(l),j*Math.sin(l))},multiply:function(j){return h.scalarMultiply(this,j)},multiplyNumber:function(j){return new h(this.x*j,this.y*j)},summ:function(j){return h.summ(this,j)},negate:function(){return this.multiplyNumber(-1)},reflectByHorizontal:function(){return new h(this.x,-this.y)},reflectByVertical:function(){return new h(-this.x,this.y)}};h.fromTwoPoints=function(k,j){return new h(j.x-k.x,j.y-k.y)};h.scalarMultiply=function(k,j){return k.x*j.x+k.y*j.y};h.summ=function(k,j){return new h(k.x+j.x,k.y+j.y)}})();(function(g){var h=function h(i){this.options=g.extend({},this.options,i||{});this._init()};window.ball=h;h.prototype={options:{radius:30,velocity:new vector(10,10),mass:1,density:1,start:new vector(100,100),canvas:null},_init:function(){var i=this.options;this.radius=i.radius;this.velocity=i.velocity;this.mass=i.density*this.area();this.start=this.center=i.start},area:function(){return Math.PI*this.radius*this.radius},move:function(i){this.center=this.velocity.multiplyNumber(i).summ(this.center)},setCenter:function(i){this.center=i}}})(jQuery);var c={isCollision:function(g){return g>=this.timeOfCollision},after:function(){},dispose:function(){}};var f=function f(i,h,g){this.ballOne=i;this.ballTwo=h;this.timeOfCollision=g};window.ballCollision=f;f.prototype=$.extend({},c,{dispose:function(){this.ballOne=undefined;this.ballTwo=undefined},after:function(){var i=this.ballOne.mass;var g=this.ballTwo.mass;var l=this.ballOne.velocity;var k=this.ballTwo.velocity;var w=this.ballOne.start;var u=this.ballTwo.start;var r=this.ballOne.center;var m=this.ballTwo.center;var v=r.summ(m.negate()).getUnitVector();var h=v.rotate(Math.PI/2);var p=l.multiply(v);var o=l.multiply(h);var j=k.multiply(v);var x=k.multiply(h);var q=(p*(i-g)+2*g*j)/(i+g);var n=(j*(g-i)+2*i*p)/(i+g);var s=vector.summ(v.multiplyNumber(q),h.multiplyNumber(o));var t=vector.summ(v.multiplyNumber(n),h.multiplyNumber(x));this.ballOne.velocity=s;this.ballTwo.velocity=t}});var e=function e(h,i,g){this.ball=h;this.isHorizontal=i;this.timeOfCollision=g};window.wallCollision=e;e.prototype=$.extend({},c,{dispose:function(){this.ball=undefined},after:function(){this.ball.velocity=this.ball.velocity[this.isHorizontal?"reflectByHorizontal":"reflectByVertical"]()}});var b=function b(g){this.options=$.extend({},this.options,g||{});this._init()};window.raphaelBall=b;b.prototype=$.extend(true,{},ball.prototype,{options:{minColor:50,maxColor:255},_init:function(){ball.prototype._init.apply(this,arguments);this.canvas=this.options.canvas;this.render()},move:function(h){var g=this;ball.prototype.move.apply(g,arguments);g.renderBall.attr({cx:g.center.x,cy:g.center.y})},_randGradient:function(){var h=this.options.maxColor;var n=this.options.minColor;var o=3;var k="";var l="";for(var m=0;m<o;++m){var j=a.randInt(n,h);var g=a.randInt(n,h);k+=Math.min(j,g).toString(16);l+=Math.max(j,g).toString(16)}return"#"+l+"-#"+k},render:function(){var g=this;if(!g.renderBall){g.renderBall=this.canvas.circle(g.center.x,g.center.y,g.radius);g.renderBall.attr({fill:"r(0.5, 0.5)"+g._randGradient(),"fill-opacity":0.8,"stroke-width":0})}}});window.ballFactory={create:function(g){return new b(g)}};var d={options:{maxV:350,minV:30,minRadius:20,maxRadius:90,step:0.05},_time:0,_epsilon:1e-7,_collision:null,_balls:[],init:function(g){this.ballFactory=g.ballFactory;this.ballOptions=g.ballOptions},addRandomBall:function(){var o=this;var h=$(window).height();var g=$(window).width();var i=this.options;var k=function(){return a.randFloat(-i.maxV,i.maxV)};var j=function(r){var t,s,q;var p=true;while(p){t=new vector(a.randInt(r,g-r),a.randInt(r,h-r));notIntersect=true;for(q=o._balls.length-1;q>=0;--q){s=o._balls[q];if(s.start.summ(t.negate()).abs()<s.radius+r){notIntersect=false;break}}p=!notIntersect}return t};var l=new vector(k(),k()),m=a.randInt(i.minRadius,i.maxRadius);var n=j(m);this._balls.push(this.ballFactory.create($.extend({radius:m,velocity:l,start:n},this.ballOptions)))},nextPosition:function(){var j,h,g,l,k;k=this.options.step;h=this._time+k;if(this._collision.timeOfCollision>h){this.moveBalls(k);return}l=this._collision.timeOfCollision-this._time;g=k;while(g>l){g-=l;this.moveBalls(l);this.setCurrentStateAsStart();this._collision.after();this.recalc();l=this._collision.timeOfCollision}this.moveBalls(g);this.setCurrentStateAsStart();this.setCurrentTimeAsStart()},setCurrentTimeAsStart:function(){this._collision.timeOfCollision-=this._time;this._time=0},setCurrentStateAsStart:function(){var g,h;for(var g=this._balls.length-1;g>=0;--g){h=this._balls[g];h.start=h.velocity.multiplyNumber(this._time).summ(h.start)}},moveBalls:function(h){var g;this._time+=h;for(g=this._balls.length-1;g>=0;--g){this._balls[g].move(h)}},timeOfCollisionVerticalWall:function(i){var g=(i.radius-i.start.x)/i.velocity.x;var h=($(window).width()-i.radius-i.start.x)/i.velocity.x;return Math.max(g,h)},timeOfCollisionHorizontalWall:function(i){var g=(i.radius-i.start.y)/i.velocity.y;var h=($(window).height()-i.radius-i.start.y)/i.velocity.y;return Math.max(g,h)},timeOfCollisionTwoBalls:function(o,j){var m=o.velocity.summ(j.velocity.negate());var l=o.start.summ(j.start.negate());var q=o.radius+j.radius;var i=vector.scalarMultiply(m,m);var h=vector.scalarMultiply(m,l);var g=vector.scalarMultiply(l,l)-q*q;var p=h*h-i*g;if(Math.abs(p)<=this._epsilon){p=0}if(p<0){return null}t1=(-h+Math.sqrt(p))/i;t2=(-h-Math.sqrt(p))/i;var k=Math.min(t1,t2);var n=Math.max(t1,t2);if(Math.abs(k)<this._epsilon){k=0}if(Math.abs(n)<this._epsilon){n=0}return n>0&&k>0?k:k<0&&n>0?n:null},recalc:function(){var l,p,n,m,g,o;m=this._balls.length;g=10000000000;for(var k=0;k<m;++k){p=this._balls[k];l=this.timeOfCollisionVerticalWall(p);if(l<g){g=l;o&&o.dispose();o=new e(p,false,l)}l=this.timeOfCollisionHorizontalWall(p);if(l<g){g=l;o&&o.dispose();o=new e(p,true,l)}for(var h=k+1;h<m;++h){n=this._balls[h];l=this.timeOfCollisionTwoBalls(p,n);if(l&&l<g){g=l;o&&o.dispose();o=new f(p,n,l)}}}this._time=0;this._collision&&this._collision.dispose();this._collision=o}};window.ballManager=d;$().ready(function(){var h=Raphael(0,0,$(window).width(),$(window).height());var k=a.randInt(1,20);d.options.step=0.02;d.init({ballFactory:ballFactory,ballOptions:{canvas:h}});for(var j=0;j<k;++j){d.addRandomBall()}var l=h.text(100,100,"Ебать, колотить.");l.attr({x:$(window).width()/2,y:$(window).height()/2,font:'52px "Times New Roman"',fill:"90-#555-#fff","text-anchor":"center"});l.toFront();d.recalc();var n=false;var m;var g=function(){d.nextPosition()};toggleMovie=function(){n=!n;if(n){m=setInterval(g,20)}else{clearInterval(m)}};$(document.body).click(toggleMovie);toggleMovie()})})();